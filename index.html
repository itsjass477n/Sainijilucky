<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Push Chat App</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
  body { font-family: Arial; margin:0; padding:0; display:flex; flex-direction:column; height:100vh; }
  #messages { flex:1; overflow-y:auto; padding:10px; border-bottom:1px solid #ccc; }
  .msg { margin:5px 0; padding:5px 10px; border-radius:5px; max-width:70%; }
  .my-msg { background:#d4edda; margin-left:auto; text-align:right; }
  .other-msg { background:#f8d7da; margin-right:auto; text-align:left; }
  #inputBar { display:flex; padding:10px; }
  #msgInput { flex:1; padding:10px; border-radius:5px; border:1px solid #ccc; }
  #sendBtn { padding:10px 20px; margin-left:5px; border:none; border-radius:5px; background:#6200ea; color:white; cursor:pointer; }
</style>
</head>
<body>

<div id="messages"></div>
<div id="inputBar">
  <input type="text" id="msgInput" placeholder="Type a message">
  <button id="sendBtn">Send</button>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDsm1U6e-4ZTi0WGBAbj1LUWOA63xpQVD0",
    authDomain: "js-world-64c90.firebaseapp.com",
    databaseURL: "https://js-world-64c90-default-rtdb.firebaseio.com",
    projectId: "js-world-64c90",
    storageBucket: "js-world-64c90.appspot.com",
    messagingSenderId: "240128005952",
    appId: "1:240128005952:android:b7f1a21647514efbe80ca5"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const userId = prompt("Enter your username"); // simple login

  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("msgInput");
  const sendBtn = document.getElementById("sendBtn");

  // Request notification permission
  if (Notification.permission !== "granted") {
    Notification.requestPermission();
  }

  // Listen for new messages
  db.ref("messages").on("child_added", snapshot => {
    const msg = snapshot.val();
    displayMessage(msg);
    if (msg.sender !== userId && Notification.permission === "granted") {
      new Notification("New message from " + msg.sender, { body: msg.text });
    }
  });

  function displayMessage(msg) {
    const div = document.createElement("div");
    div.className = "msg " + (msg.sender === userId ? "my-msg" : "other-msg");
    div.innerText = msg.sender + ": " + msg.text;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  sendBtn.onclick = () => {
    const text = input.value.trim();
    if (!text) return;
    db.ref("messages").push({
      text,
      sender: userId,
      timestamp: Date.now()
    });
    input.value = "";
  };

  input.addEventListener("keypress", e => {
    if (e.key === "Enter") sendBtn.click();
  });
</script>
</body>
</html>
